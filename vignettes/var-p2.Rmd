---
title: "fitAutoReg: Vector Autoregressive Model - VAR(p = 2)"
author: "Ivan Jacob Agaloos Pesigan"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{fitAutoReg: Vector Autoregressive Model - VAR(p = 2)}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---




```r
library(simAutoReg)
library(fitAutoReg)
```

## Generate data


```r
set.seed(42)
time <- 1000L
burn_in <- 200L
k <- 3
p <- 2
constant <- c(1, 1, 1)
coef <- matrix(
  data = c(
    0.4, 0.0, 0.0, 0.1, 0.0, 0.0,
    0.0, 0.5, 0.0, 0.0, 0.2, 0.0,
    0.0, 0.0, 0.6, 0.0, 0.0, 0.3
  ),
  nrow = k,
  byrow = TRUE
)
chol_cov <- chol(diag(3))
dat_p2 <- simAutoReg::SimVAR(
  time = time,
  burn_in = burn_in,
  constant = constant,
  coef = coef,
  chol_cov = chol_cov
)
```

## Ordinary Least Squares


```r
Y <- dat_p2_yx$Y
X <- dat_p2_yx$X
FitVAROLS(Y = Y, X = X)
#>           [,1]        [,2]        [,3]        [,4]        [,5]         [,6]
#> [1,] 0.7899726  0.36836768 0.008539283  0.02231498  0.11338780  0.024505442
#> [2,] 1.0001995  0.01334496 0.481949237 -0.01730029 -0.03223315  0.234373552
#> [3,] 1.0666814 -0.03022951 0.014945306  0.60741736 -0.01610408 -0.006149189
#>             [,7]
#> [1,] -0.01143384
#> [2,]  0.01815779
#> [3,]  0.29620975
```

## Lasso Regularization


```r
Ystd <- StdMat(dat_p2_yx$Y)
Xstd <- StdMat(dat_p2_yx$X[, -1])
lambdas <- LambdaSeq(Y = Ystd, X = Xstd, n_lambdas = 100)
FitVARLassoSearch(Ystd = Ystd, Xstd = Xstd, lambdas = lambdas,
  crit = "ebic", max_iter = 1000, tol = 1e-5)
#>           [,1]     [,2]     [,3]       [,4]      [,5]      [,6]
#> [1,] 0.3429428 0.000000 0.000000 0.08487819 0.0000000 0.0000000
#> [2,] 0.0000000 0.457026 0.000000 0.00000000 0.2120426 0.0000000
#> [3,] 0.0000000 0.000000 0.588127 0.00000000 0.0000000 0.2737749
```

## Dynr


```r
dynr_model <- ModelVARP2Dynr(data = dat_p2)
coef(
  object = dynr_model,
  dynr_cook = FitVARDynr(model = dynr_model, hessian_flag = FALSE)
)
#> $constant
#> [1] 0.8108203 1.0385953 1.0830291
#> 
#> $coef
#>             [,1]        [,2]        [,3]         [,4]         [,5]        [,6]
#> [1,]  0.36766728 0.007391896  0.01983247  0.114497325  0.024832351 -0.01065118
#> [2,]  0.01376537 0.480781804 -0.01962650 -0.038003569  0.233819340  0.01853446
#> [3,] -0.03337367 0.013277403  0.60707078 -0.009727031 -0.004752739  0.29460604
#> 
#> $cov
#>              [,1]         [,2]         [,3]
#> [1,]  0.986841754 -0.054124215 -0.004444707
#> [2,] -0.054124215  1.007742802  0.008107844
#> [3,] -0.004444707  0.008107844  0.987783462
```

### Multiple individuals


```r
n <- 10 # n individuals
dat_p2_mult <- lapply(
  X = seq_len(n),
  FUN = function(i) {
    return(
      simAutoReg::SimVAR(
        time = 1000L,
        burn_in = 10,
        constant = constant,
        coef = coef,
        chol_cov = chol_cov
      )
    )
  }
)
```

Single VAR model on the entire data set.


```r
dynr_model <- ModelVARP2Dynr(data = dat_p2_mult)
coef(
  object = dynr_model,
  dynr_cook = FitVARDynr(model = dynr_model, hessian_flag = FALSE)
)
#> $constant
#> [1] 1.0448029 0.9746017 1.0014669
#> 
#> $coef
#>             [,1]         [,2]         [,3]         [,4]         [,5]
#> [1,]  0.40121116 -0.009609459 -0.003694735  0.104843203 -0.006740511
#> [2,] -0.00886161  0.504827496 -0.007677505  0.002317086  0.208803378
#> [3,] -0.01568661  0.004431672  0.584943385 -0.001003501  0.014681107
#>             [,6]
#> [1,] 0.004724077
#> [2,] 0.006492386
#> [3,] 0.312771409
#> 
#> $cov
#>             [,1]        [,2]         [,3]
#> [1,]  0.99995757 0.017928481 -0.016324570
#> [2,]  0.01792848 0.982177366  0.004719771
#> [3,] -0.01632457 0.004719771  0.998661138
```

Multiple VAR models on each individual.


```r
dynr_cook <- FitMLVARDynr(data = dat_p2_mult, p = 2, hessian_flag = FALSE)
#> Error in FUN(X[[i]], ...): unused argument (conf.level = 0.95)
dynr_model <- ModelVARP2Dynr(data = dat_p2_mult[[1]])
lapply(
  X = dynr_cook,
  FUN = function(dynr_cook,
                 dynr_model) {
    coef(
      object = dynr_model,
      dynr_cook = dynr_cook
    )
  },
  dynr_model = ModelVARP2Dynr(data = dat_p2_mult[[1]])
)
#> Error in eval(expr, envir, enclos): object 'dynr_cook' not found
```
